<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор Комиссий</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background: #0B0F14; color: #EAF0FF; padding: 20px; }
        .container { max-width: 400px; margin: 0 auto; }
        label { display: block; margin-top: 15px; color: #93A4C7; font-size: 14px; }
        input, select { 
            width: 100%; padding: 12px; margin-top: 5px; 
            background: #121923; border: 1px solid #2a3441; 
            color: #fff; border-radius: 8px; font-size: 16px; box-sizing: border-box;
        }
        button {
            width: 100%; padding: 14px; margin-top: 20px;
            background: #4DA3FF; color: white; border: none;
            border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer;
        }
        button:hover { background: #3b8ce0; }
        .result {
            margin-top: 20px; padding: 15px;
            background: #1c2533; border-radius: 12px;
            display: none; 
        }
        .error { color: #FF5A6A; }
        .success { color: #3CCB7F; margin-bottom: 5px;}
        .val { font-size: 24px; font-weight: bold; margin-top: 5px; }
        .sub { font-size: 13px; color: #93A4C7; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;}
    </style>
</head>
<body>

<div class="container">
    <h2>Калькулятор Ozon</h2>

    <label>Название категории / товара</label>
    <input type="text" id="catInput" placeholder="Например: 3D-очки">
    
    <label>Цена товара (руб)</label>
    <input type="number" id="priceInput" placeholder="1000">

    <label>Схема работы</label>
    <select id="schemaSelect">
        <option value="fbo">FBO (со склада Ozon)</option>
        <option value="fbs">FBS (со своего склада)</option>
        <option value="rfbs">RFBS / DBS</option>
    </select>

    <button onclick="calculate()">Рассчитать комиссию</button>

    <div id="resultBox" class="result">
        <div id="resText"></div>
    </div>
</div>

<script>
    // Инициализация Telegram WebApp (чтобы работала кнопка Назад и цвета)
    if (window.Telegram && window.Telegram.WebApp) {
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();
    }

    async function calculate() {
        const cat = document.getElementById('catInput').value;
        const price = document.getElementById('priceInput').value;
        const schema = document.getElementById('schemaSelect').value;
        const resBox = document.getElementById('resultBox');
        const resText = document.getElementById('resText');

        if(!cat || !price) {
            alert("Введите категорию и цену");
            return;
        }

        resBox.style.display = 'block';
        resText.innerHTML = 'Загрузка...';

        try {
            const response = await fetch(`/api/calculator/commission?categoryName=${encodeURIComponent(cat)}&price=${price}&schema=${schema}`);
            const data = await response.json();

            if (data.found) {
                resText.innerHTML = `
                    <div class="sub">Найдена категория: <br><b>${data.category}</b></div>
                    <div class="success">Комиссия (${schema.toUpperCase()}):</div>
                    <div class="val">${data.commissionPercent}%</div>
                `;
            } else {
                resText.innerHTML = `<div class="error">${data.message || data.error || "Ошибка"}</div>`;
            }
        } catch (e) {
            console.error(e);
            resText.innerHTML = `<div class="error">Ошибка соединения с сервером</div>`;
        }
    }
</script>

</body>
</html>
