<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü—Ä–æ–¥–∞–∂–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, button { width: 100%; margin: 10px 0; padding: 10px; }
    .count { font-size: 48px; text-align: center; }
  </style>
</head>
<body>

<div id="form">
  <input id="client" placeholder="Client ID">
  <input id="key" placeholder="API Key">
  <button onclick="save()">–ì–æ—Ç–æ–≤–æ</button>
</div>

<div id="widget" style="display:none">
  <h3>–ü—Ä–æ–¥–∞–∂–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
  <div class="count" id="count">‚Äî</div>
  <button onclick="load()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();

  const telegram_id = tg.initDataUnsafe.user.id;

  async function save() {
    await fetch("/api/save-credentials", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        telegram_id,
        client_id: client.value,
        api_key: key.value
      })
    });
    form.style.display = "none";
    widget.style.display = "block";
    load();
  }

  async function load() {
    const res = await fetch(`/api/today-sales?telegram_id=${telegram_id}`);
    const data = await res.json();
    count.innerText = data.count;
  }
</script>

</body>
</html>
